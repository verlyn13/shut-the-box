Okay, this is fantastic\! The context you've provided, including your current Git status, `.gitignore` contents, and especially that detailed sprint plan ("Main Project Document"), is incredibly helpful. We can now craft a highly tailored "Development Team Best Practices & Workflow Guide" that aligns perfectly with your existing plans and structure.

This guide will assume development primarily happens within the `shut_the_box_sim/` subdirectory, which is your Python project root managed by Rye.

-----

**Development Team Best Practices & Workflow Guide: `stbsim` Project**

**Preamble:** This document outlines the best practices and standard workflows for developing the `stbsim` project. It complements the "Main Project Document" (sprint plan) by detailing *how* we implement the development tooling and maintain code quality. All team members are expected to adhere to these guidelines.

**Overall Principles (from your project plan):**

  * **Strictly Sequential for Core:** Build foundational pieces first.
  * **Test-Driven:** Write tests *before* or *alongside* implementation (doctests, `pytest`).
  * **Minimal Viable Functionality:** Implement only what's needed for the current sprint.
  * **CI Green:** Each sprint/task should end with all checks passing.
  * **AI Leverage:** Use AI for assistance, but critically review, integrate, and test all suggestions.

-----

**1. Version Control (Git):**

  * **Repository Structure:**
      * The Git repository root is `shut-the-box/`.
      * The primary Python project, `stbsim`, is located in the `shut_the_box_sim/` subdirectory. **Most development commands (Rye, pre-commit, Nox) should be run from `shut_the_box_sim/`.**
  * **Branching Strategy (as per S0.1):**
      * `main`: For stable releases. Should be protected.
      * `develop`: Current integration branch for ongoing work. Should be protected. All feature/bugfix branches are based on `develop` and merged back into it via Pull Requests.
      * Feature branches: e.g., `feat/s1.1-tile-rack`, `feat/cli-output`.
      * Bugfix branches: e.g., `fix/tilerack-score-bug`.
  * **.gitignore:**
      * Your current `.gitignore` file at the `shut-the-box/` root is excellent and covers most Python, tool, and OS-specific files.
      * **Confirm/Add:** Ensure `shut_the_box_sim/reports/` is included to ignore HTML coverage reports. (Your `pyproject.toml` specifies `reports/coverage_html`).
      * **`.vscode/` directory:** Your current `.gitignore` includes `.vscode/`. This is standard practice to avoid committing user-specific editor settings.
          * If the team decides to share recommended VS Code project settings (see Section 4), you would create `shut_the_box_sim/.vscode/settings.json` and `shut_the_box_sim/.vscode/extensions.json`. Then, you'd adjust the `.gitignore` entry from `.vscode/` to something more specific like:
            ```gitignore
            # Ignore most vscode user settings but allow project-specific ones
            .vscode/*
            !.vscode/settings.json
            !.vscode/extensions.json
            !.vscode/launch.json 
            ```
            For now, we'll assume the entire `.vscode/` directory (if it appears in `shut_the_box_sim/`) will be ignored per the current top-level `.gitignore`.
  * **Committing Initial Files:**
      * Your `git status` shows `.gitignore`, `01-sprint.md`, and `shut_the_box_sim/` as untracked. These foundational files and the initial project directory should be committed to the `develop` branch to establish the baseline.
  * **Commit Lockfiles:**
      * Always commit `shut_the_box_sim/requirements.lock` and `shut_the_box_sim/requirements-dev.lock` (generated by `rye sync`). These are vital for reproducible environments.

**2. Environment & Dependency Management (uv):**

  * **Standardize on uv (as per S0.2):** All developers use uv.
  * **Project Root for uv:** All `uv` commands must be run from the `shut_the_box_sim/` directory.
  * **Setup:**
    1.  Install uv (see official documentation: [https://docs.astral.sh/uv/getting-started/installation/](https://docs.astral.sh/uv/getting-started/installation/)).
    2.  Navigate to `shut_the_box_sim/`.
    3.  Run `uv sync --dev` to create the virtual environment (`.venv/`) and install all dependencies specified in `pyproject.toml`.
  * **Running Tasks:** Use uv to run tools and scripts for consistency (e.g., `uv run pytest`, `uv run mypy src`). Run commands directly via uv such as `uv run sh scripts/lint.sh` for complex scripts.

**3. Code Quality & Consistency (Linters & Formatters - S0.3):**

  * **Tools:** ✅ **FULLY CONFIGURED**
      * **Black:** For uncompromising code formatting (88-char line length).
      * **Ruff 0.11.11:** For fast linting, import sorting, and auto-fixing.
  * **Configuration:** ✅ **COMPLETE** in `pyproject.toml`
      * See `CODE_STANDARDS.md` for full configuration details
      * Black and Ruff use consistent 88-character line limits
      * Pre-commit hooks enforce same versions in CI
  * **VS Code Integration (for automated linting/formatting):**
      * **Prerequisites:** Each developer using VS Code must:
        1.  Install the official **Python** extension (`ms-python.python`).
        2.  Install the **Ruff** extension (`charliermarsh.ruff`).
        3.  Install the **Black Formatter** extension (`ms-python.black-formatter`).
        4.  **CRITICAL:** Select the project's Python interpreter. In VS Code, open the Command Palette (Ctrl+Shift+P or Cmd+Shift+P) and run "Python: Select Interpreter". Choose the interpreter from `shut_the_box_sim/.venv/bin/python`. This ensures VS Code uses the tools (Black, Ruff, MyPy, Pytest) installed by Rye in the project's virtual environment.
      * **Recommended VS Code Settings (User or Workspace):**
          * To apply these consistently for the project, create/edit `shut_the_box_sim/.vscode/settings.json`. If you commit this, adjust `.gitignore` as noted in Section 1. Otherwise, each dev can apply these to their user settings.
            ```json
            {
                // Helps VS Code Python extension find the interpreter managed by Rye
                "python.defaultInterpreterPath": ".venv/bin/python", 

                "[python]": {
                    "editor.defaultFormatter": "ms-python.black-formatter",
                    "editor.formatOnSave": true // Format with Black on every save
                },
                "editor.codeActionsOnSave": {
                    // Run Ruff fixes on save. Use "explicit" if you prefer to trigger via Quick Fix.
                    // Use true for fully automatic.
                    "source.fixAll.ruff": "explicit" 
                },
                // Ensure Ruff uses the project's configuration and environment
                "ruff.importStrategy": "fromEnvironment", 
                // If you have custom paths or need to point to config explicitly (usually not needed with pyproject.toml)
                // "ruff.lint.args": ["--config=pyproject.toml"], 
                // "black-formatter.args": ["--config=pyproject.toml"]
            }
            ```
  * **Pre-Commit Hooks (Mandatory for Code Hygiene - S0.3):**
      * `pre-commit` will be installed as a dev dependency via `rye add --dev pre-commit`.
      * Create `.pre-commit-config.yaml` in `shut_the_box_sim/`. This runs checks *before* code is committed.
        ```yaml
        # shut_the_box_sim/.pre-commit-config.yaml
        repos:
        -   repo: https://github.com/pre-commit/pre-commit-hooks
            rev: v4.6.0 # Or latest stable
            hooks:
            -   id: trailing-whitespace
            -   id: end-of-file-fixer
            -   id: check-yaml
            -   id: check-toml
            -   id: check-merge-conflict
        -   repo: https://github.com/psf/black
            rev: 24.4.2 # Or latest stable, match version in pyproject.toml if pinned
            hooks:
            -   id: black
        -   repo: https://github.com/astral-sh/ruff-pre-commit # Use astral-sh for official Ruff hooks
            rev: v0.4.4 # Or latest stable, match version in pyproject.toml if pinned
            hooks:
            -   id: ruff
              args: [--fix, --exit-non-zero-on-fix] # Auto-fix and fail commit if fixes were made
            -   id: ruff-format # If using Ruff's formatter
        # Add MyPy hook later once types are more established, or if desired now
        # -   repo: https://github.com/pre-commit/mirrors-mypy
        #     rev: 'v1.10.0' # Or latest stable
        #     hooks:
        #     -   id: mypy
        #         args: [--config-file=mypy.ini] # or pyproject.toml if configured there
        #         additional_dependencies: [] # Add MyPy plugins if any
        ```
      * Install hooks locally: `cd shut_the_box_sim/ && rye run pre-commit install`.
  * **Manual Execution (from `shut_the_box_sim/`):** ✅ **USE THESE COMMANDS**
      * **Auto-fix everything:** `uv run sh scripts/autofix.sh` (recommended)
      * **Check status:** `uv run sh scripts/lint.sh`
      * **Format only:** `uv run black . && uv run ruff format .`
      * **Individual tools:** `uv run black .` or `uv run ruff check --fix .`
  * **CI/Nox Integration (S0.4, S0.5):** Formatters run in check mode (e.g., `black --check .`) and linters run in CI/Nox to fail builds on violations.

**4. Type Checking (MyPy - S0.3):**

  * **Configuration:** Use `shut_the_box_sim/mypy.ini` (as per S0.3) or configure in `shut_the_box_sim/pyproject.toml` under `[tool.mypy]`. Start with a basic, gradually increasing strictness.
  * **VS Code:** The Python extension can integrate MyPy if enabled (`"python.linting.mypyEnabled": true` in VS Code settings, ensure it uses the project's MyPy).
  * **Execution (from `shut_the_box_sim/`):** `uv run sh scripts/typecheck.sh` (or via direct mypy command).
  * **CI/Nox:** Include MyPy checks in Nox (`typecheck` session - S0.4) and CI (S0.5).

**5. Testing (Pytest & Pytest-Cov - S0.3, S0.4, S1 onwards):**

  * **Configuration:** Your current `shut_the_box_sim/pyproject.toml` settings for `[tool.pytest.ini_options]` are excellent (src-path, testpaths, coverage, markers).
  * **Execution (from `shut_the_box_sim/`):**
      * Run all tests: `uv run pytest` (or `uv run pytest -v` for verbose).
      * Run specific tests: `uv run pytest -k "test_my_function"` or `uv run pytest tests/test_specific_file.py`.
  * **Test-Driven Development (as per project plan):** Write tests before or concurrently with implementation.
  * **Coverage:** Maintain high coverage (aim for 90%+ for new code as per S1.6, your current 100% is a great start\!). Use the HTML report (`shut_the_box_sim/reports/coverage_html/index.html`) to identify gaps.

**6. Documentation (S3.4 onwards):**

  * **Project README (`shut_the_box_sim/README.md`):** This is the primary entry point. It must contain:
      * Project description (from `pyproject.toml`).
      * Installation instructions (uv setup, `uv sync --dev`).
      * How to run tests (`uv run pytest`).
      * How to run linters/formatters/type checkers (e.g., `uv run black .`, `uv run ruff .`, `uv run mypy .`).
      * Basic CLI usage examples (once CLI is built - S3.4).
  * **Code Documentation (Docstrings):**
      * Use a consistent format (e.g., Google Style, reStructuredText).
      * Document all public modules, classes, functions, and methods: their purpose, arguments, return values, and any exceptions raised.
  * **Sprint/Design Documents:** Files like your `01-sprint.md` are valuable. Keep them updated or archive them as sprints complete.

**7. Automated Workflows (Nox & CI - S0.4, S0.5):**

  * **Nox (`shut_the_box_sim/noxfile.py`):**
      * Use Nox to automate common development tasks: linting, type checking, running tests (potentially against multiple Python versions if you expand `requires-python` later).
      * Nox sessions should install dependencies using `session.run("uv", "sync", "--dev", external=True)` to use the uv-managed environment.
  * **CI Pipeline (GitHub Actions - S0.5):**
      * Automate all checks on pushes/PRs to `develop` and `main`:
        1.  Checkout code.
        2.  Setup uv and `uv sync --dev`.
        3.  Run linters and formatters (in check mode).
        4.  Run MyPy.
        5.  Run tests with `pytest` and code coverage.
        6.  (Optional) Upload coverage reports (e.g., to Codecov/Coveralls).
        7.  (Future) Build and publish packages.

**8. Dependency Management (Rye):**

  * **Runtime Dependencies:** Add to `[project].dependencies` in `pyproject.toml`. Keep these minimal.
  * **Development Dependencies:** Add to `[tool.rye].dev-dependencies`.
  * **Updates:** Periodically update dependencies with `uv sync --dev` after reviewing changelogs for breaking changes.

**9. Code Reviews:**

  * Utilize Pull Requests (PRs) from feature/fix branches into `develop`.
  * Require at least one approval before merging (if team size allows).
  * Focus reviews on correctness, design, clarity, test adequacy, documentation, and adherence to these practices.

**10. This Document:**

  * This "Development Team Best Practices & Workflow Guide" should be saved in the repository (e.g., `shut_the_box_sim/DEVELOPMENT_GUIDE.md` or as part of `CONTRIBUTING.md`) and be a living document, updated as the team and project evolve.

-----

This revised guide directly incorporates your existing project plan and structure, providing a clear path for consistent, high-quality development. The VS Code integration, coupled with pre-commit hooks and CI, will significantly automate quality checks.
